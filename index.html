<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Car Chase Game</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 20px;
      z-index: 10;
    }
  </style>
</head>
<body>
<div id="score">Score: 0</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
  // Scene
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);

  // Camera
  const camera = new THREE.PerspectiveCamera(
    75, window.innerWidth / window.innerHeight, 0.1, 1000
  );
  camera.position.set(0, 5, 10);
  camera.lookAt(0, 0, 0);

  // Renderer
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Light
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5, 10, 5);
  scene.add(light);

  // Road
  const roadGeo = new THREE.BoxGeometry(10, 0.1, 200);
  const roadMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
  const road = new THREE.Mesh(roadGeo, roadMat);
  road.position.z = -90;
  scene.add(road);

  // Road markings (repeating lines)
  const lineGeo = new THREE.BoxGeometry(0.5, 0.05, 6);
  const lineMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
  const lines = [];
  for (let i = -80; i < 80; i += 12) {
    const l = new THREE.Mesh(lineGeo, lineMat);
    l.position.set(0, 0.06, i);
    scene.add(l);
    lines.push(l);
  }

  // Player Car
  const carGeo = new THREE.BoxGeometry(1.5, 1, 3);
  const carMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
  const playerCar = new THREE.Mesh(carGeo, carMat);
  playerCar.position.set(0, 0.6, 2);
  scene.add(playerCar);

  // Police Car
  const policeMat = new THREE.MeshStandardMaterial({ color: 0x0000ff });
  const policeCar = new THREE.Mesh(carGeo, policeMat);
  policeCar.position.set(0, 0.6, -10);
  scene.add(policeCar);

  // Simple shadow feel by adding a plane (not real shadows)
  const groundGeo = new THREE.PlaneGeometry(200, 200);
  const groundMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI / 2;
  ground.position.y = 0;
  scene.add(ground);

  // Controls
  let left = false, right = false;
  document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft" || e.key === "a") left = true;
    if (e.key === "ArrowRight" || e.key === "d") right = true;
  });
  document.addEventListener("keyup", e => {
    if (e.key === "ArrowLeft" || e.key === "a") left = false;
    if (e.key === "ArrowRight" || e.key === "d") right = false;
  });

  // Touch controls for mobile
  let touchStartX = null;
  window.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
  });
  window.addEventListener('touchmove', (e) => {
    if (touchStartX == null) return;
    const dx = e.touches[0].clientX - touchStartX;
    if (dx < -20) { left = true; right = false; }
    else if (dx > 20) { right = true; left = false; }
  });
  window.addEventListener('touchend', () => {
    left = right = false;
    touchStartX = null;
  });

  let score = 0;
  let gameOver = false;

  function animate() {
    if (gameOver) return;
    requestAnimationFrame(animate);

    // Move road illusion
    road.position.z += 0.5;
    if (road.position.z > 0) road.position.z = -90;

    // Move the dashed lines with wrapping
    for (const l of lines) {
      l.position.z += 0.5;
      if (l.position.z > 100) l.position.z = -100;
    }

    // Player movement with small easing
    if (left && playerCar.position.x > -4) playerCar.position.x -= 0.2;
    if (right && playerCar.position.x < 4) playerCar.position.x += 0.2;
    // slight drift back to center
    playerCar.position.x *= 0.98;

    // Police chase (follows player's x and moves forward)
    policeCar.position.x += (playerCar.position.x - policeCar.position.x) * 0.02;
    policeCar.position.z += 0.08; // police moves forward slowly

    // Score increases faster the longer you survive
    score += 1;
    document.getElementById("score").innerText = "Score: " + Math.floor(score / 10);

    // Game Over collision check (simple distance check)
    const dz = policeCar.position.z - playerCar.position.z;
    const dx = policeCar.position.x - playerCar.position.x;
    const dist = Math.sqrt(dx * dx + dz * dz);
    if (dist < 2.2) {
      gameOver = true;
      setTimeout(() => {
        alert("Busted! Score: " + Math.floor(score / 10));
        location.reload();
      }, 50);
    }

    // Camera follow a bit
    camera.position.x += (playerCar.position.x - camera.position.x) * 0.05;
    camera.lookAt(playerCar.position.x, playerCar.position.y, playerCar.position.z);

    renderer.render(scene, camera);
  }

  animate();

  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>