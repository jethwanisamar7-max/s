<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>3D Car Chase</title>
<style>
  body { margin: 0; overflow: hidden; background: black; }
  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-family: Arial;
    font-size: 18px;
    z-index: 10;
  }
</style>
</head>
<body>

<div id="ui">
  Score: <span id="score">0</span><br>
  Car: <span id="carName">Basic</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ---------- SCENE ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 500);
camera.position.set(0, 6, 10);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,5);
scene.add(light);

/* ---------- ROAD ---------- */
const road = new THREE.Mesh(
  new THREE.BoxGeometry(8,0.1,500),
  new THREE.MeshStandardMaterial({ color:0x333333 })
);
road.position.y = 0.05;
road.position.z = -200;
scene.add(road);

/* ---------- PLAYER CAR ---------- */
const carGeo = new THREE.BoxGeometry(1.5,1,3);
const carMat = new THREE.MeshStandardMaterial({ color:0xff0000 });
const playerCar = new THREE.Mesh(carGeo, carMat);
playerCar.position.y = 0.6;
scene.add(playerCar);

/* ---------- POLICE ---------- */
const police = new THREE.Mesh(
  carGeo,
  new THREE.MeshStandardMaterial({ color:0x0000ff })
);
police.position.set(0,0.6,-12);
scene.add(police);

/* ---------- CARS DATA ---------- */
const cars = [
  { name:"Basic", color:0xff0000, speed:0.18, cost:0 },
  { name:"Sport", color:0x00ff00, speed:0.25, cost:500 },
  { name:"Super", color:0xffff00, speed:0.32, cost:1
<script>
/* ========= CAR SYSTEM ========= */

const cars = [
  { name: "Basic", color: 0xff0000, speed: 0.5, price: 0 },
  { name: "Sport", color: 0x00ff00, speed: 0.7, price: 300 },
  { name: "Super", color: 0xffff00, speed: 0.9, price: 800 }
];

let currentCarIndex = 0;
let score = 0;
let gameOver = false;

// Scene
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

// Camera
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.set(0, 5, 10);

// Renderer
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5, 10, 5);
scene.add(light);

// Road
const road = new THREE.Mesh(
  new THREE.BoxGeometry(10, 0.1, 200),
  new THREE.MeshStandardMaterial({ color: 0x333333 })
);
road.position.z = -90;
scene.add(road);

// Player car
let playerCar;
function createCar() {
  if (playerCar) scene.remove(playerCar);
  const c = cars[currentCarIndex];
  playerCar = new THREE.Mesh(
    new THREE.BoxGeometry(1.5, 1, 3),
    new THREE.MeshStandardMaterial({ color: c.color })
  );
  playerCar.position.set(0, 0.6, 2);
  scene.add(playerCar);
  document.getElementById("carName").innerText = c.name;
}
createCar();

// Police
const police = new THREE.Mesh(
  new THREE.BoxGeometry(1.5, 1, 3),
  new THREE.MeshStandardMaterial({ color: 0x0000ff })
);
police.position.set(0, 0.6, -10);
scene.add(police);

// Controls
let left = false, right = false;
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft" || e.key === "a") left = true;
  if (e.key === "ArrowRight" || e.key === "d") right = true;

  if (["1","2","3"].includes(e.key)) {
    const idx = parseInt(e.key) - 1;
    if (score >= cars[idx].price) {
      currentCarIndex = idx;
      createCar();
    }
  }
});
document.addEventListener("keyup", e => {
  if (e.key === "ArrowLeft" || e.key === "a") left = false;
  if (e.key === "ArrowRight" || e.key === "d") right = false;
});

// Animation loop
function animate() {
  if (gameOver) return;
  requestAnimationFrame(animate);

  const speed = cars[currentCarIndex].speed;

  road.position.z += speed;
  if (road.position.z > 0) road.position.z = -90;

  if (left && playerCar.position.x > -4) playerCar.position.x -= 0.2;
  if (right && playerCar.position.x < 4) playerCar.position.x += 0.2;

  police.position.x += (playerCar.position.x - police.position.x) * 0.02;
  police.position.z += 0.08;

  score++;
  document.getElementById("score").innerText = Math.floor(score / 10);

  const dx = police.position.x - playerCar.position.x;
  const dz = police.position.z - playerCar.position.z;
  if (Math.sqrt(dx*dx + dz*dz) < 2.2) {
    gameOver = true;
    alert("Busted! Score: " + Math.floor(score / 10));
    location.reload();
  }

  camera.position.x += (playerCar.position.x - camera.position.x) * 0.05;
  camera.lookAt(playerCar.position);

  renderer.render(scene, camera);
}

animate();

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
